---
layout: post
title:  "Nodemailer"
category: dev
---

## SSL vs TSL vs STARTTLS

SSLå’ŒTSLéƒ½æä¾›äº†åŠ å¯†é€šä¿¡çš„åŠŸèƒ½ï¼ŒTSLæ˜¯SSLçš„ç»§ä»»è€…ã€‚

STARTTLSæŠŠä¸€æ¡ä¸å®‰å…¨çš„é€šä¿¡è¿æ¥å‡çº§æˆå®‰å…¨çš„è¿æ¥ã€‚

åŸå…ˆçš„é€šä¿¡æ˜¯æ˜æ–‡é€šä¿¡ï¼Œåæ¥æœ‰äº†åŠ å¯†é€šä¿¡ï¼Œä¸ºäº†å…¼å®¹ä»¥å‰çš„ä»£ç ï¼Œæ¯ç§é‚®ä»¶åè®®æ–°å¢äº†ä¸€ä¸ªç«¯å£æ¥ä¼ è¾“åŠ å¯†çš„æ•°æ®ã€‚

SMTPåè®®é»˜è®¤ç«¯å£25, SSL/TLSåŠ å¯†çš„SMTPçš„é»˜è®¤ç«¯å£æ˜¯465ã€‚

ä¸€ä¸ªåè®®ä½¿ç”¨ä¸¤ä¸ªç«¯å£çœ‹èµ·æ¥æœ‰äº›æµªè´¹ï¼Œäºæ˜¯å‡ºç°äº†STARTTLSã€‚å…ˆä½¿ç”¨æ™®é€šç«¯å£ç”Ÿæˆä¸€ä¸ªä¸å®‰å…¨çš„è¿æ¥ï¼Œç„¶ååœ¨ä½¿ç”¨STARTTLSå°†å…¶å‡çº§æˆå®‰å…¨çš„è¿æ¥ã€‚

æ–°æ ‡å‡†æŒ‡å®šSMTPä½¿ç”¨587ç«¯å£æäº¤é‚®ä»¶ï¼Œä½¿ç”¨STARTTLSåšåŠ å¯†ä¼ è¾“ã€‚

ç”±äºå¤§é‡è€ä»£ç é—ç•™é—®é¢˜ï¼Œç°åœ¨SMTPçš„æƒ…å†µæ˜¯ï¼šä¸€äº›äººä½¿ç”¨STARTTLSåœ¨ç«¯å£587ä¸Šç™»å½•æœåŠ¡å™¨ï¼Œä¸€äº›äººä½¿ç”¨ç«¯å£465ç”¨SSL/TLSç™»å½•é‚®ä»¶æœåŠ¡å™¨ï¼Œè¿˜æœ‰ä¸€äº›äººä»ç„¶æ²¿ç”¨25ç«¯å£ç”¨STARTTLSç™»å½•æœåŠ¡å™¨ã€‚

## Nodemailer

Nodemaileræ˜¯ä¸€ä¸ªNode.jsæ¨¡å—ï¼Œç”¨äºå‘é€é‚®ä»¶ã€‚
### ä½¿ç”¨è¦æ±‚

- Node.js v6.0.0æˆ–è€…æ›´é«˜ç‰ˆæœ¬

å¦‚æœè¦ä½¿ç”¨`async..await`è¯­æ³•ï¼Œé‚£ä¹ˆè‡³å°‘è¦Node v8.0.0ã€‚

### å¿«é€Ÿä¸Šæ‰‹

>TL;DR is an abbreviation for "too long; didn't read" that is used to indicate that the person posting about an article or other type of content either didn't read the text it in its entirety or didn't read it at all.

ä½¿ç”¨Nodemailerå‘é€é‚®ä»¶åªéœ€è¦3æ­¥ï¼š
1. åˆ›å»ºä¸€ä¸ªtransporterå¯¹è±¡ï¼Œå¯ä»¥åŸºäºSMTPåè®®ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–åè®®
```
let transporter = nodemailer.createTransport({
    host: "smtp.ethereal.email",
    port: 587,
    secure: false, // true for 465, false for other ports
    auth: {
      user: testAccount.user, // generated ethereal user
      pass: testAccount.pass, // generated ethereal password
    },
  });
```
2.  è®¾ç½®é‚®ä»¶ä¿¡æ¯
```
let mailInfo = {
    rom: '"Fred Foo ğŸ‘»" <foo@example.com>', // sender address
    to: "bar@example.com, baz@example.com", // list of receivers
    subject: "Hello âœ”", // Subject line
    text: "Hello world?", // plain text body
    html: "<b>Hello world?</b>", // html body
}
```
3. å‘é€é‚®ä»¶
```
await transporter.sendMail(mailInfo);
```
### APIè¯¦è§£

```
let transporter = nodemailer.createTransport(transport[, defaults])
```
- `transport`æ˜¯é‚®ä»¶ä¼ è¾“é…ç½®ä¿¡æ¯ï¼Œå¯ä»¥æ˜¯é…ç½®å¯¹è±¡ã€è¿æ¥URLå’Œä¼ è¾“æ’ä»¶å®ä¾‹
- `defaults`é‚®ä»¶ä¿¡æ¯é»˜è®¤é€‰é¡¹


```
transporter.sendMail(message[, callback])
```
- `message` é‚®ä»¶å†…å®¹
- `callback` æ˜¯å›è°ƒå‡½æ•°ï¼Œå½“é‚®ä»¶å‘é€æˆåŠŸæˆ–å¤±è´¥åä¼šè‡ªåŠ¨è°ƒç”¨
    - `err` é”™è¯¯å¯¹è±¡
    - `info`åŒ…å«å‘é€ç»“æœä¿¡æ¯ï¼Œå…·ä½“çš„æ ¼å¼ä¾èµ–äºä½¿ç”¨çš„ä¼ è¾“åè®®
        - `info.messageId` æ¶ˆæ¯ID
        - `info.envelope`
        - `info.accepted` é‚®ä»¶æœåŠ¡å™¨æ¥æ”¶çš„æ”¶ä»¶äºº
        - `info.rejected` é‚®ä»¶æœåŠ¡å™¨æ‹’ç»çš„æ”¶ä»¶äºº
        - `info.pending` é‚®ä»¶æœåŠ¡å™¨æš‚æ—¶æ‹’ç»çš„æ”¶ä»¶äºº
        - `response` å“åº”

å¦‚æœæ²¡æœ‰æŒ‡å®šå›è°ƒå‡½æ•°ï¼Œæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªPromiseå¯¹è±¡ã€‚

é‚®ä»¶å†…å®¹ `message` åŒ…å«ä»¥ä¸‹å­—æ®µï¼š
- `from` å‘ä»¶äººåœ°å€
- `to` æ”¶ä»¶äººåˆ—è¡¨
- `cc` æŠ„é€äººåˆ—è¡¨
- `bcc` éšè—æŠ„é€äººåˆ—è¡¨
- `subject` ä¸»é¢˜
- `text` æ˜æ–‡ä¿¡æ¯
- `html` htmlæ ¼å¼çš„ä¿¡æ¯
- `attachments` é™„ä»¶åˆ—è¡¨

æ‰€æœ‰æ–‡æœ¬å†…å®¹ï¼ˆé‚®ä»¶åœ°å€ã€æ˜æ–‡ã€htmlã€é™„ä»¶åï¼‰ä½¿ç”¨UTF-8ç¼–ç ï¼Œé™„ä»¶ä½œä¸ºäºŒè¿›åˆ¶æµã€‚


## å‚è€ƒ
1. [SSL vs TLS vs STARTTLS](https://blog.csdn.net/xtjie/article/details/81659934)
2. [STARTTLS, SSL and TLS â€“ Whatâ€™s the Difference?](https://www.plusplushosting.net/blog/starttls-ssl-and-tls-whats-the-difference/)
